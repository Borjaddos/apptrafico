<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Predicciones de Transporte</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <style>
        body { font-family: Arial, sans-serif; }
        #map { height: 400px; }
        .container { margin: 20px; }
        .prediccion { margin-top: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <nav>
            <ul>
                <li><a href="/">Home</a></li>
                <li><a href="/about">About</a></li>
            </ul>
        </nav>

        <h1>Predicciones de Transporte</h1>
        <label for="fecha">Selecciona una fecha:</label>
        <input type="date" id="fecha" value="{{ fecha_actual }}">

        <label for="hora">Selecciona una hora:</label>
        <input type="time" id="hora" value="{{ hora_actual }}" step="3600">

        <button id="actualizar">Actualizar Mapa</button>

        <div id="map"></div>

        <div class="prediccion">
            <h3>Próxima Predicción Mayor a 400</h3>
            <!-- Aquí puedes mostrar los detalles de la próxima predicción -->
            <div id="proxima-prediccion">
                <!-- Lógica para mostrar la predicción puede ir aquí -->
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        var map = L.map('map').setView([43.25, -2.96], 10);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        var estaciones = JSON.parse('{{ estaciones | tojson | safe }}');
        estaciones.forEach(function(estacion) {
            var markerColor;

            if (estacion.ida > 500 || estacion.vuelta > 500) {
                markerColor = 'red';
            } else if (estacion.ida > 300 || estacion.vuelta > 300) {
                markerColor = 'orange';
            } else {
                markerColor = 'green';
            }

            var marker = L.circleMarker([estacion.Y, estacion.X], {
                color: markerColor,
                radius: 8
            }).addTo(map);

            marker.bindPopup("<b>Estación: " + estacion.Estacion + "</b><br>" +
                "Ida: " + estacion.ida + "<br>" +
                "Vuelta: " + estacion.vuelta);
        });

        document.getElementById("actualizar").onclick = function() {
            var fecha = document.getElementById("fecha").value;
            var hora = document.getElementById("hora").value;
            window.location.href = "/?fecha=" + fecha + "&hora=" + hora;
        };
    </script>
</body>
</html>

